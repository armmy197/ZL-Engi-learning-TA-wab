<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ZL TA-Learning | เรียนสดออนไลน์</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./css/styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

</head>

<body>
  <!-- Background -->
  <div class="app-bg"></div>

  <!-- Topbar -->
  <header class="topbar glass">
    <div class="topbar-left">
      <button id="btnSidebarToggle" class="icon-btn" aria-label="Toggle menu">
        <span class="burger"></span>
      </button>

  <div class="brand">
  <img class="brand-logo" alt="ZL Logo"
       src="https://cdn.jsdelivr.net/gh/armmy197/ZL-Engi-learning-TA-wab-/logo_ZL.png" />
  <div class="brand-text">
    <div class="brand-title">ZL TA-Learning</div>
    <div class="brand-subtitle">ระบบสอนสดออนไลน์ เรียนได้ทุกที่ ทุกสถานการณ์</div>
  </div>
</div>


    <div class="topbar-right">
      <span id="pillRole" class="pill hidden"></span>
      <button id="btnRole" class="btn btn-primary">เลือกบทบาท / เข้าสู่ระบบ</button>
      <button id="btnLogout" class="btn btn-ghost hidden">ออกจากระบบ</button>
    </div>
  </header>

  <div class="layout">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar glass">
      <nav class="nav">
        <a class="nav-item active" data-route="home" href="#">
          <span class="dot"></span> หน้าแรก
        </a>

        <div class="nav-section">ผู้เรียน</div>
        <a class="nav-item" data-route="student-courses" href="#">
          <span class="dot"></span> คอร์สเรียน
        </a>
        <a class="nav-item" data-route="student-live" href="#">
          <span class="dot"></span> เข้าเรียนสด
        </a>
        <a class="nav-item" data-route="student-lessons" href="#">
          <span class="dot"></span> บทเรียน
        </a>
        <a class="nav-item" data-route="student-quizzes" href="#">
          <span class="dot"></span> แบบฝึกหัด
        </a>
        <a class="nav-item" data-route="student-docs" href="#">
          <span class="dot"></span> เอกสารเรียน
        </a>

        <div class="nav-section admin-only hidden">ผู้สอน / แอดมิน</div>
        <a class="nav-item admin-only hidden" data-route="admin-dashboard" href="#">
          <span class="dot"></span> แดชบอร์ด
        </a>
        <a class="nav-item admin-only hidden" data-route="admin-courses" href="#">
          <span class="dot"></span> จัดการคอร์ส
        </a>
        <a class="nav-item admin-only hidden" data-route="admin-students" href="#">
          <span class="dot"></span> จัดการผู้เรียน
        </a>
        <a class="nav-item admin-only hidden" data-route="admin-lessons" href="#">
          <span class="dot"></span> จัดการบทเรียน / แบบฝึกหัด
        </a>
        <a class="nav-item admin-only hidden" data-route="admin-docs" href="#">
          <span class="dot"></span> เอกสารเรียน (เปิด/ปิดสิทธิ์)
        </a>
        <a class="nav-item admin-only hidden" data-route="admin-export" href="#">
          <span class="dot"></span> ดาวน์โหลดข้อมูล CSV
        </a>

        <div class="nav-section">ติดต่อ</div>
        <a class="nav-item" href="https://www.facebook.com/share/1QDWzBoeXL/" target="_blank" rel="noreferrer">
          <span class="dot"></span> Facebook Page
        </a>
      </nav>
      <div class="sidebar-footer">
        <div class="small muted"></div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <!-- Home -->
      <section id="view-home" class="view active">
        <div class="hero glass">
          <div class="hero-left">
            <h1>เรียนจีนวิศวกรรมแบบ <span class="grad">เรียนสด</span></h1>
            <p class="muted">
              เงื่อนไข: ผู้เรียนต้อง “เข้าร่วมเรียนสด” ก่อน จึงจะปลดล็อกแบบฝึกหัดและเอกสารดาวน์โหลด
            </p>
            <div class="hero-actions">
              <button id="btnJoinAsStudent" class="btn btn-primary">เข้าเป็นผู้เรียน</button>
              <button id="btnLoginAdmin" class="btn btn-secondary">เข้าสู่ระบบแอดมิน</button>
            </div>
            <div class="small muted">
              * ผู้เรียนไม่ต้องสมัครสมาชิก (กรอกชื่อ + ยินยอมเข้าร่วม)  
            </div>
          </div>
          <div class="hero-right">
            <div class="stat-cards">
              <div class="card glass">
                <div class="card-title">ผู้เรียนทั้งหมด</div>
                <div id="statTotalStudents" class="card-value">—</div>
              </div>
              <div class="card glass">
                <div class="card-title">กำลังเรียนสด</div>
                <div id="statLiveNow" class="card-value">—</div>
              </div>
              <div class="card glass">
                <div class="card-title">คอร์สทั้งหมด</div>
                <div id="statTotalCourses" class="card-value">—</div>
              </div>
            </div>

            <div class="card glass chart-wrap">
              <div class="card-title">สถิติผู้เรียน (ตัวอย่าง)</div>
              <canvas id="studentsChart" height="130"></canvas>
            </div>
          </div>
        </div>

        <div class="grid-2">
          <div class="card glass">
            <div class="card-title">คอร์สที่กำลังโปรโมท</div>
            <div id="promoteArea" class="muted">—</div>
          </div>

          <div class="card glass">
            <div class="card-title">คอร์สทั้งหมด</div>
            <div id="courseGridHome" class="course-grid"></div>
          </div>
        </div>
      </section>

      <!-- Student views -->
      <section id="view-student-courses" class="view">
        <div class="view-head">
          <h2>คอร์สเรียน</h2>
          <div class="small muted">เลือกคอร์ส แล้วกด “เข้าร่วมเรียน” เพื่อเริ่มเรียนสด</div>
        </div>
        <div id="courseGridStudent" class="course-grid"></div>
      </section>

      <section id="view-student-live" class="view">
        <div class="view-head">
          <h2>เข้าเรียนสด</h2>
          <div class="small muted">ระบบจะเปิด Google Meet ในหน้าต่างลอย</div>
        </div>
        <div id="livePanel" class="card glass"></div>
      </section>

      <section id="view-student-lessons" class="view">
        <div class="view-head">
          <h2>บทเรียน</h2>
          <div class="small muted">ปลดล็อกเมื่อแอดมินประกาศ “จบคอร์ส”</div>
        </div>
        <div id="lessonsPanel" class="card glass"></div>
      </section>

      <section id="view-student-quizzes" class="view">
        <div class="view-head">
          <h2>แบบฝึกหัด</h2>
          <div class="small muted">ตอบผิดได้ไม่เกิน 2 ครั้ง (ครั้งที่ 2 แสดงเฉลย)</div>
        </div>
        <div id="quizPanel" class="card glass"></div>
      </section>

      <section id="view-student-docs" class="view">
        <div class="view-head">
          <h2>เอกสารเรียน</h2>
          <div class="small muted">ดาวน์โหลดได้เมื่อแอดมินเปิดสิทธิ์ให้คอร์ส</div>
        </div>
        <div id="docsPanel" class="card glass"></div>
      </section>

      <!-- Admin views -->
      <section id="view-admin-dashboard" class="view">
        <div class="view-head">
          <h2>แดชบอร์ดแอดมิน</h2>
          <div class="small muted">ภาพรวมผู้เรียน/คอร์ส/สถานะเรียนสด</div>
        </div>
        <div class="grid-2">
          <div class="card glass">
            <div class="card-title">กราฟผู้เรียน</div>
            <canvas id="adminStudentsChart" height="140"></canvas>
          </div>
          <div class="card glass">
            <div class="card-title">สถานะระบบ</div>
            <div id="adminStatusBox" class="muted">—</div>
          </div>
        </div>
      </section>

      <section id="view-admin-courses" class="view">
        <div class="view-head">
          <h2>จัดการคอร์ส</h2>
          <button id="btnAddCourse" class="btn btn-primary">+ เพิ่มคอร์ส</button>
        </div>
        <div id="adminCoursesPanel" class="card glass"></div>
      </section>

          <section id="view-admin-lessons" class="view">
      <div class="view-head">
        <h2>จัดการบทเรียน / แบบฝึกหัด</h2>
        <div class="small muted">เลือกคอร์ส → เพิ่มบทเรียน → เพิ่มแบบฝึกหัด (URL/อัปโหลดรูป + เฉลย)</div>
      </div>
      <div id="adminLessonsPanel" class="card glass">
        <div class="muted">กำลังโหลด...</div>
      </div>
    </section>

      <section id="view-admin-students" class="view">
        <div class="view-head">
          <h2>จัดการผู้เรียน</h2>
          <div class="small muted">ดูรายชื่อ เปลี่ยนสถานะ ลบผู้เรียน</div>
        </div>
        <div id="adminStudentsPanel" class="card glass"></div>
      </section>

      <section id="view-admin-docs" class="view">
        <div class="view-head">
          <h2>เอกสารเรียน (เปิด/ปิดสิทธิ์)</h2>
          <div class="small muted">อัปโหลด/ผูกคอร์ส และควบคุมสิทธิ์ดาวน์โหลด</div>
        </div>
        <div id="adminDocsPanel" class="card glass"></div>
      </section>

      <section id="view-admin-export" class="view">
        <div class="view-head">
          <h2>ดาวน์โหลดข้อมูล CSV</h2>
          <div class="small muted">เฉพาะแอดมินเท่านั้น</div>
        </div>
        <div class="card glass export-actions">
          <button id="btnExportStudents" class="btn btn-secondary">ดาวน์โหลดรายชื่อผู้เรียน (CSV)</button>
          <button id="btnExportCourses" class="btn btn-secondary">ดาวน์โหลดรายชื่อคอร์ส (CSV)</button>
          <div class="small muted">ไฟล์จะถูกสร้างจากข้อมูลใน Firestore</div>
        </div>
      </section>
    </main>
  </div>

  <!-- Promote popup -->
  <div id="promoteModal" class="modal hidden">
    <div class="modal-card glass">
      <div class="modal-head">
        <div class="modal-title">คอร์สแนะนำ</div>
        <button class="icon-btn" data-close="promoteModal" aria-label="Close">✕</button>
      </div>
      <div id="promoteBody" class="modal-body"></div>
      <div class="modal-actions">
        <button class="btn btn-primary" data-close="promoteModal">รับทราบ</button>
      </div>
    </div>
  </div>

  <!-- Role modal -->
  <div id="roleModal" class="modal hidden">
    <div class="modal-card glass">
      <div class="modal-head">
        <div class="modal-title">เลือกบทบาท</div>
        <button class="icon-btn" data-close="roleModal" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">
        <div class="role-grid">
          <button id="roleStudent" class="role-card">
            <div class="role-title">ผู้เรียน (Student)</div>
            <div class="role-sub">ไม่ต้องสมัครสมาชิก</div>
          </button>
          <button id="roleAdmin" class="role-card">
            <div class="role-title">แอดมิน (Admin)</div>
            <div class="role-sub">เข้าสู่ระบบด้วยรหัส</div>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Student join modal -->
  <div id="studentJoinModal" class="modal hidden">
    <div class="modal-card glass">
      <div class="modal-head">
        <div class="modal-title">เข้าสู่ระบบผู้เรียน</div>
        <button class="icon-btn" data-close="studentJoinModal" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">
        <label class="label">ชื่อ–นามสกุล</label>
        <input id="studentFullname" class="input" placeholder="เช่น สมชาย ใจดี" />

        <div class="check-row">
          <input id="studentConsent" type="checkbox" />
          <label for="studentConsent">ยินยอมเข้าร่วมเรียนสด และให้บันทึกเวลาเข้าเรียน</label>
        </div>

        <label class="label">เลือกคอร์ส</label>
        <select id="studentCourseSelect" class="input"></select>

        <div class="hint small muted">
          เมื่อเข้าเป็นผู้เรียนแล้ว คุณต้องกด “เข้าร่วมเรียน” และเข้าเรียนสด เพื่อให้ระบบบันทึกสถานะ
        </div>
      </div>
      <div class="modal-actions">
        <button id="btnStudentJoin" class="btn btn-primary">เข้าสู่ระบบ</button>
      </div>
    </div>
  </div>

  <!-- Admin login modal -->
  <div id="adminLoginModal" class="modal hidden">
    <div class="modal-card glass">
      <div class="modal-head">
        <div class="modal-title">เข้าสู่ระบบแอดมิน</div>
        <button class="icon-btn" data-close="adminLoginModal" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">
        <label class="label">Username</label>
        <input id="adminUsername" class="input" placeholder="username" />
        <label class="label">Password</label>
        <input id="adminPassword" class="input" type="password" placeholder="123456" />
        <div class="small muted">
          * แนะนำ: ใช้ Firebase Auth + Security Rules ในงานจริง (การฮาร์ดโค้ดรหัสบนฝั่งเว็บไม่ปลอดภัย)
        </div>
      </div>
      <div class="modal-actions">
        <button id="btnAdminLogin" class="btn btn-primary">เข้าสู่ระบบ</button>
      </div>
    </div>
  </div>

  <!-- Course form modal (admin) -->
  <div id="courseFormModal" class="modal hidden">
    <div class="modal-card glass modal-wide">
      <div class="modal-head">
        <div id="courseFormTitle" class="modal-title">เพิ่มคอร์ส</div>
        <button class="icon-btn" data-close="courseFormModal" aria-label="Close">✕</button>
      </div>
      <div class="modal-body grid-2">
        <div>
          <label class="label">ชื่อคอร์ส</label>
          <input id="courseName" class="input" placeholder="Chinese Engineering EP.1" />
          <label class="label">รูปหน้าปก (URL)</label>
          <input id="courseCover" class="input" placeholder="https://..." />
          <label class="label">รายละเอียด</label>
          <textarea id="courseDesc" class="input" rows="4" placeholder="คำอธิบายคอร์ส..."></textarea>
        </div>
        <div>
          <label class="label">ลิงก์ Google Meet</label>
          <input id="courseMeet" class="input" placeholder="https://meet.google.com/..." />
          <div class="check-row">
            <input id="coursePromote" type="checkbox" />
            <label for="coursePromote">โปรโมทคอร์ส (Popup ครั้งแรก)</label>
          </div>
          <div class="check-row">
            <input id="courseDocsOpen" type="checkbox" />
            <label for="courseDocsOpen">เปิดสิทธิ์ดาวน์โหลดเอกสาร</label>
          </div>
          <div class="check-row">
            <input id="courseQuizOpen" type="checkbox" />
            <label for="courseQuizOpen">ปลดล็อกแบบฝึกหัด</label>
          </div>
          <div class="check-row">
            <input id="courseLessonOpen" type="checkbox" />
            <label for="courseLessonOpen">ปลดล็อกบทเรียน</label>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button id="btnSaveCourse" class="btn btn-primary">บันทึก</button>
      </div>
    </div>
  </div>

  <!-- Live floating popup -->
  <div id="liveFloat" class="live-float hidden">
    <div class="live-float-head">
      <div class="live-title">Live Class</div>
      <div class="live-actions">
        <button id="btnLiveMin" class="icon-btn" title="ย่อ">—</button>
        <button id="btnLiveMax" class="icon-btn" title="ขยาย">▢</button>
        <button id="btnLiveClose" class="icon-btn" title="ปิด">✕</button>
      </div>
    </div>
    <div class="live-float-body">
      <iframe id="liveFrame" title="Google Meet"></iframe>
      <div class="live-fallback">
        <div class="small muted">ถ้า Google Meet แสดงไม่ได้ ให้กดปุ่มนี้</div>
        <button id="btnLiveOpenNew" class="btn btn-secondary">เปิด Meet ในแท็บใหม่</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast hidden"></div>

 <script type="module" src="./js/app.js"></script>

</body>
</html>

